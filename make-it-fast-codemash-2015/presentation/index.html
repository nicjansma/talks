<!doctype html>
<html lang="en">
<!--
TODO:
http://stackoverflow.com/questions/14657849/can-i-use-the-browser-navigation-timing-api-for-ajax-events-in-single-page-apps
http://stackoverflow.com/questions/tagged/navigation-timing-api
-->
    <head>
        <meta charset="utf-8">

        <title>Make it Fast: Using Modern Brower APIs to Monitor and Improve the Performance of your Web Applications</title>

        <meta name="description" content="Make it Fast: Using Modern Brower APIs to Monitor and Improve the Performance of your Web Applications">
        <meta name="author" content="Nic Jansma">

        <meta name="apple-mobile-web-app-capable" content="yes" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <link rel="stylesheet" href="css/reveal.min.css">
        <link rel="stylesheet" href="css/theme/nicj.css" id="theme">

        <!-- For syntax highlighting -->
        <link rel="stylesheet" href="lib/css/zenburn.css">

        <!-- If the query includes 'print-pdf', include the PDF print sheet -->
        <script>
            if( window.location.search.match( /print-pdf/gi ) ) {
                var link = document.createElement( 'link' );
                link.rel = 'stylesheet';
                link.type = 'text/css';
                link.href = 'css/print/pdf.css';
                document.getElementsByTagName( 'head' )[0].appendChild( link );
            }
        </script>

        <!--[if lt IE 9]>
        <script src="lib/js/html5shiv.js"></script>
        <![endif]-->
    </head>

    <body>
        <div class="reveal">
            <div class="slides">
                <section>
                    <h1>Make it Fast</h1>

                    <p>Using Modern Brower APIs to Monitor and Improve the Performance of your Web Applications</p>

                    <p style="margin-top: 40px">
                        <small><a href="http://nicj.net">nic jansma</a> |</small>
                        <small><a href="http://nicj.net">nicj.net</a> |</small>
                        <small><a href="http://twitter.com/nicj">@nicj</a></small>
                    </p>
                </section>

                <section>
                    <div style="float: right; text-align: center">
                        <img src="images/nic.jpg" height="300" width="300" />
                    </div>

                    <h2>Who Am I?</h2>

                    <p>Nic Jansma</p>
                    <p><a href="mailto:nic@nicj.net">nic@nicj.net</a></p>
                    <p><a href="https://twitter.com/nicj/">@nicj</a></p>
                    <p><a href="http://nicj.net">http://nicj.net</a></p>
                    <p><img src="images/soasta.png" /></p>

                    <ul>
                        <li>SOASTA (current)</li>
                        <li>Microsoft (2005-2011)</li>
                        <li>Founding member of W3C WebPerf Working Group</li>
                    </ul>
                </section>

                <section>
                    <section>
                        <h2>State of Performance Measurement</h2>

                        <p>How do we measure performance?</p>
                    </section>

                    <section>
                        <h3>Server</h3>
                        <ul>
                            <li>HTTP logs (apache, nginx, haproxy)</li>
                            <li>Server monitoring (top, iostat, vmstat, cacti, mrtg, nagios, new relic)</li>
                            <li>Profiling (timestamps, xdebug, xhprof)</li>
                            <li>Load testing (ab, jmeter, soasta, blazemeter, loadrunner)
                        </ul>
                    </section>

                    <section>
                        <h3>Developer</h3>
                        <ul>
                            <li>Browser developer tools (ie, chrome, ff, opera, safari)</li>
                            <li>Network monitoring (fiddler, wireshark, tcpdump)</li>
                        </ul>
                    </section>

                    <section>
                        <h3>But...</h3>
                        <ul>
                            <li>Measuring performance from the server and developer perspective is not the full story</li>

                            <li>The only thing that really matters is what your end-user sees</li>

                            <li>Measuring real-world performance of your end-users is tough</li>
                        </ul>
                    </section>

                    <section>
                        <h3>User</h3>
                        <p><small>(circa 2010)</small></p>
                        <ul>
                            <li><code>var elapsedTime = Date.now() - startTime;</code></li>
                            <li>Boomerang: <a href="https://github.com/lognormal/boomerang">github.com/lognormal/boomerang</a></li>
                        </ul>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>W3C WebPerf Working Group</h2>

                        <p><a href="http://www.w3.org/2010/webperf/">www.w3.org/2010/webperf</a></p>

                        <p>Founded 2010 to give developers the ability to assess and understand performance characteristics of their web apps</p>

                        <blockquote style="margin-top: 50px;">The mission of the Web Performance Working Group is to provide methods to measure aspects of application performance of user agent features and APIs</blockquote>

                        <p style="margin-top: 50px;">Microsoft, Google, Mozilla, Opera, Facebook, Netflix, etc</p>
                    </section>

                    <section>
                        <h2>Working Group Goals</h2>

                        <ul>
                        <li>Expose information that was not previously available</li>

                        <li>Give developers the tools they need to make their applications more efficient</li>

                        <li>Little to no overhead</li>

                        <li>Easy to understand APIs</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Published Specs</h2>

                        <ul>
                            <li><strong>Navigation Timing</strong> (NT): Page load timings</li>
                            <li><strong>Resource Timing</strong> (RT): Resource load timings</li>
                            <li><strong>User Timing</strong> (UT): Custom site events and measurements</li>
                            <li><strong>Performance Timeline</strong>: Access NT/RT/UT and future timings from one API</li>
                            <li><strong>High Resolution Time</strong>: Better <code>Date.now()</code></li>
                        </ul>
                    </section>

                    <section>
                        <h2>Published Specs (pt 2)</h2>

                        <ul>
                            <li><strong>Page Visibility</strong>: Visibility state of document</li>
                            <li><strong>Timing control for script-based animations</strong>: <code>requestAnimationFrame()</code></li>
                            <li><strong>Efficient Script Yielding</strong>: More efficient than <code>setTimeout(...,0)</code>: <code>setImmediate()</code></li>
                        </ul>
                    </section>

                    <section>
                        <h2>Upcoming Specs</h2>
                        <ul>
                            <li>Beacon: Async send data (even after page is closed)</li>
                            <li>Resource Hints: <code>rel="preconnect" rel="preload"</code></li>
                            <li>Resource Priorities: <code>lazyload</code></li>
                            <li>Frame Timing: Animation timings</li>
                            <li>Navigation Error Logging: For failed navigations</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Participate!</h2>

                        <p style="margin-top: 50px;"><a href="http://www.w3.org/2010/webperf/">www.w3.org/2010/webperf</a></p>

                        <p style="margin-top: 50px;"><a href="mailto:public-web-perf@w3.org">public-web-perf@w3.org</a></p>

                        <p style="margin-top: 50px;"><a href="https://github.com/w3c/web-performance">github.com/w3c/web-performance</a></p>
                    </section>

                    <!-- reason I mention this is to encourage you -- if you're interested in any of these
                    things, feel free to participate on the email group or Github issues -->
                </section>

                <section>
                    <section>
                        <h2>NavigationTiming</h2>

                        <p><a href="http://www.w3.org/TR/navigation-timing/">www.w3.org/TR/navigation-timing</a></p>

                        <p style='margin-top: 50px'><strong>Goal: </strong> Expose accurate performance metrics describing your visitor's page load
                            experience</p>

                        <p style='margin-top: 50px'><strong>Current status</strong>: Recommendation</p>

                        <p style='margin-top: 50px'><strong>Upcoming</strong>: NavigationTiming2</p>

                    </section>

                    <section>
                        <h2>How it was done before</h2>

                        <p><small>(this isn't accurate)</small></p>

<pre><code data-trim class="javascript">
&lt;html&gt;&lt;head&gt;&lt;script&gt;
var start = new Date().getTime();
function onLoad {
    var pageLoadTime = (new Date().getTime()) - start;
}
body.addEventListener(“load”, onLoad, false);
&lt;/script&gt;...&lt;/html&gt;
</code></pre>
                    </section>

                    <section>
                        <h2>What's wrong with this?</h2>

                        <ul>
                            <li>It only measures the time from when the HTML gets parsed to when the last
                                sub-resource is downloaded</li>

                            <li>It misses the initial DNS lookup, TCP connection and HTTP request wait time</li>

                            <li><code>Date().getTime()</code> is not reliable</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Interlude</h2>

                        <p><code>DOMHighResTimeStamp</code></p>

                        <table>
                            <tr>
                                <th></th>
                                <th>Date</th>
                                <th><code>DOMHighResTimeStamp</code></th>
                            </tr>
                            <tr>
                                <td>Accessed Via</td>
                                <td><code>Date().getTime()</code></td>
                                <td><code>performance.now()</code></td>
                            </tr>
                            <tr>
                                <td>Resolution</td>
                                <td>millisecond</td>
                                <td>sub-millisecond</td>
                            </tr>
                            <tr>
                                <td>Start</td>
                                <td>Unix epoch</td>
                                <td><code>navigationStart</code></td>
                            </tr>
                            <tr>
                                <td>Monotonically Non-decreasing</td>
                                <td>No</td>
                                <td>Yes</td>
                            </tr>
                            <tr>
                                <td>Affected by user's clock</td>
                                <td>Yes</td>
                                <td>No</td>
                            </tr>
                            <tr>
                                <td>Example</td>
                                <td><code>1420147524606</code></td>
                                <td><code>3392.275999998674</code></td>
                            </tr>
                        </table>
                    </section>

                    <section>
                        <h2>NavigationTiming</h2>

                        <p><code>window.performance.timing</code></p>

<pre><code data-trim class="javascript">
interface PerformanceTiming {
    readonly attribute unsigned long long navigationStart;
    readonly attribute unsigned long long unloadEventStart;
    readonly attribute unsigned long long unloadEventEnd;
    readonly attribute unsigned long long redirectStart;
    readonly attribute unsigned long long redirectEnd;
    readonly attribute unsigned long long fetchStart;
    readonly attribute unsigned long long domainLookupStart;
    readonly attribute unsigned long long domainLookupEnd;
    readonly attribute unsigned long long connectStart;
    readonly attribute unsigned long long connectEnd;
    readonly attribute unsigned long long secureConnectionStart;
    readonly attribute unsigned long long requestStart;
    readonly attribute unsigned long long responseStart;
    readonly attribute unsigned long long responseEnd;
    readonly attribute unsigned long long domLoading;
    readonly attribute unsigned long long domInteractive;
    readonly attribute unsigned long long domContentLoadedEventStart;
    readonly attribute unsigned long long domContentLoadedEventEnd;
    readonly attribute unsigned long long domComplete;
    readonly attribute unsigned long long loadEventStart;
    readonly attribute unsigned long long loadEventEnd;
};
</code></pre>
                    </section>

                    <section>
                        <h2>NavigationTiming</h2>

                        <img src="images/navigation-timing.png" />
                    </section>

                    <section>
                        <h2>NavigationTiming</h2>

                        <p><code>window.performance.navigation</code></p>

<pre><code data-trim class="javascript">
interface PerformanceNavigation {
    const unsigned short TYPE_NAVIGATE = 0;
    const unsigned short TYPE_RELOAD = 1;
    const unsigned short TYPE_BACK_FORWARD = 2;
    const unsigned short TYPE_RESERVED = 255;
    readonly attribute unsigned short type;
    readonly attribute unsigned short redirectCount;
};
</code></pre>
                    </section>

                    <section>
                        <h2>How to Use</h2>

<pre><code data-trim class="javascript">
function onLoad() {
    if ('performance' in window && 'timing' in window.performance) {
        setTimeout(function() {
            var t = window.performance.timing;
            var ntData = {
                redirect: t.redirectEnd - t.redirectStart,
                dns: t.domainLookupEnd - t.domainLookupStart,
                connect: t.connectEnd - t.connectStart,
                ssl: t.secureConnectionStart ? (t.connectEnd - secureConnectionStart) : 0,
                request: t.responseStart - t.requestStart,
                response: t.responseEnd - t.responseStart,
                dom: t.loadEventStart - t.responseEnd,
                total: t.loadEventEnd - t.navigationStart
            };
        }, 0);
    }
}
</code></pre>

                    </section>

                    <section>
                        <h2>Then what?</h2>

                        <p>DIY / Open Source options:</p>

                        <ul>
                            <li>Send this data to your backend for logging</li>

                            <!-- sample a percent -->

                            <li>Show any page's timings via a bookmarklet: <a href="http://kaaes.github.io/timing/">kaaes.github.io/timing</a></li>

                            <li>Boomerang: <a href="https://github.com/lognormal/boomerang">github.com/lognormal/boomerang</a></li>
                            <li>Boomcatch: <a href="http://cruft.io/posts/introducing-boomcatch/">cruft.io/posts/introducing-boomcatch</a></li>
                            <li>BoomerangExpress: <a href="https://github.com/andreas-marschke/boomerang-express">github.com/andreas-marschke/boomerang-express</a></li>
                            <li>SiteSpeed.io: <a href="http://www.sitespeed.io/">www.sitespeed.io</a></li>
                            <li>Piwiki: <a href="https://github.com/piwik/piwik/">github.com/piwik/piwik</a></li>
                        </ul>
                    </section>

                    <section>
                        <h2>Commercial</h2>

                        <ul>
                            <li>Google Analytics Site Speed: <a href="http://www.google.com/analytics/">google.com/analytics</a></li>
                            <li>New Relic Browser: <a href="http://newrelic.com/browser-monitoring">newrelic.com/browser-monitoring</a></li>
                            <li>NeuStar WPM: <a href="http://www.neustar.biz/">neustar.biz</a></li>
                            <li>SOASTA mPulse: <a href="http://soasta.com">soasta.com</a></li>
                            <li>SpeedCurve: <a href="http://speedcurve.com/">speedcurve.com</a></li>
                        </ul>
                    </section>

                    <section>
                        <h2>NavigationTiming</h2>

                        <p><a href="http://caniuse.com/#feat=nav-timing">caniuse.com/#feat=nav-timing</a></p>

                        <img src="images/navigation-timing-caniuse.png" />
                    </section>

                    <section>
                        <h2>Tips</h2>

                        <ul>
                            <li>Use <code>fetchStart</code> instead of <code>navigationStart</code> unless you're interested in redirects, tab init time, etc</li>
                            <li><strong>All</strong> redirects are grouped between <code>redirectStart</code> and <code>redirectEnd</code></li>
                            <li><code>loadEventEnd</code> will be 0 until <i>after</i> the body's <code>load</code> event has finished (so you can't measure it in the <code>load</code> event)</li>
                            <li>We don't have an accurate way to measure the "request time", as "<code>requestEnd</code>" is invisible to us (the server sees it)</li>
                            <li><code>secureConnectionStart</code> isn't available in IE</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Tips</h2>

                        <img src="images/navigation-timing.png" />
                    </section>

                    <section>
                        <h2>Tips (pt 2)</h2>

                        <ul>
                            <li>iOS still doesn't have support</li>
                            <li>Home page scenarios: Timestamps up through <code>responseEnd</code> event may be 0 duration because some browsers speculatively pre-fetch home pages (and don't report the correct timings)</li>
                            <li>If possbile, do any beaconing of the data as soon as possible.  Browser <code>onbeforeunload</code> isn't 100% reliable for sending data</li>
                            <li>Single-Page Apps: You'll need a different solution for "navigations" (Boomerang + plugin coming soon)</li>
                        </ul>
                    </section>

                    <section>
                        <h2>NavigationTiming2</h2>

                        <p><a href="http://www.w3.org/TR/navigation-timing-2/">www.w3.org/TR/navigation-timing-2</a></p>

                        <p><strong>DRAFT</strong></p>

                        <p>Builds on NavigationTiming:</p>

                        <ul>
                            <li>Support for Performance Timeline</li>
                            <li>Support for High Resolution Time</li>
                            <li>timing information for link negotiation</li>
                            <li>timing information for prerender</li>
                        </ul>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>ResourceTiming</h2>

                        <p><a href="http://www.w3.org/TR/resource-timing/">www.w3.org/TR/resource-timing</a></p>

                        <p style='margin-top: 50px'><strong>Goal: </strong> Expose sub-resource performance metrics</p>

                            <p style='margin-top: 50px'><strong>Current status</strong>: Working Draft</p>

                    </section>

                    <section>
                        <h2>Inspiration</h2>

                        <img src="images/resource-timing-inspiration.png" />
                    </section>

                    <section>
                        <h2>How it was done before</h2>

                        <p style="margin-top: 50px">For dynamically inserted content, you could time how long it took from DOM
                            insertion to the element’s onLoad event</p>
                    </section>

                    <section>
                        <h2>How it was done before</h2>

                        <p><small>(this isn't practical for all content)</small></p>

<pre><code data-trim class="javascript">
var start = new Date().getTime();
var image1 = new Image();
var resourceTiming = function() {
    var now = new Date().getTime();
    var latency = now - start;
    alert("End to end resource fetch: " + latency);
};

image1.onload = resourceTiming;
image1.src = 'http://www.w3.org/Icons/w3c_main.png';
</code></pre>
                    </section>

                    <section>
                        <h2>What's wrong with this?</h2>

                        <ul>
                            <li>It measures end-to-end download time plus rendering time</li>

                            <li>Not practical if you want to measure every resource on the page (IMG, SCRIPT, LINK rel="css", etc)</li>

                            <li><code>Date().getTime()</code> is not reliable</li>
                        </ul>
                    </section>

                    <section>
                        <h2>ResourceTiming</h2>

                        <p><code>window.performance.getEntries()</code></p>

<pre><code data-trim class="javascript">
interface PerformanceEntry {
    readonly attribute DOMString name;
    readonly attribute DOMString entryType;
    readonly attribute DOMHighResTimeStamp startTime;
    readonly attribute DOMHighResTimeStamp duration;
};

interface PerformanceResourceTiming : PerformanceEntry {
    readonly attribute DOMString initiatorType;

    readonly attribute DOMHighResTimeStamp redirectStart;
    readonly attribute DOMHighResTimeStamp redirectEnd;
    readonly attribute DOMHighResTimeStamp fetchStart;
    readonly attribute DOMHighResTimeStamp domainLookupStart;
    readonly attribute DOMHighResTimeStamp domainLookupEnd;
    readonly attribute DOMHighResTimeStamp connectStart;
    readonly attribute DOMHighResTimeStamp connectEnd;
    readonly attribute DOMHighResTimeStamp secureConnectionStart;
    readonly attribute DOMHighResTimeStamp requestStart;
    readonly attribute DOMHighResTimeStamp responseStart;
    readonly attribute DOMHighResTimeStamp responseEnd;
};
</code></pre>
                    </section>

                    <section>
                        <h2>Interlude: PerformanceTimeline</h2>

                        <p><a href="http://www.w3.org/TR/performance-timeline/">www.w3.org/TR/performance-timeline</a></p>

                        <p style='margin-top: 50px'><strong>Goal: </strong> Unifying interface to access and retrieve performance metrics</p>

                        <p style='margin-top: 50px'><strong>Current status</strong>: Recommendation</p>
                    </section>

                    <section>
                        <h2>PerformanceTimeline</h2>

                        <p><code>window.performance</code></p>

                        <ul>
                            <li><code>getEntries()</code>: Gets all entries in the timeline</li>
                            <li><code>getEntriesByType()</code>: Gets all entries of the specified type (eg <code>resource</code>, <code>mark</code>, <code>measure</code>)</li>
                            <li><code>getEntriesByName()</code>: Gets all entries with the specified name (eg URL or mark name)</li>
                        </ul>
                    </section>

                    <section>
                        <h2>ResourceTiming</h2>

                        <img src="images/resource-timing.png" />
                    </section>

                    <section>
                        <h2>How to Use</h2>

                        <p><code>window.performance.getEntriesByType("resource")[0]</code></p>

<pre><code data-trim class="javascript">
{
    connectEnd: 566.357000003336,
    connectStart: 566.357000003336,
    domainLookupEnd: 566.357000003336,
    domainLookupStart: 566.357000003336,
    duration: 4.275999992387369,
    entryType: "resource",
    fetchStart: 566.357000003336,
    initiatorType: "img",
    name: "https://www.foo.com/foo.png",
    redirectEnd: 0,
    redirectStart: 0,
    requestStart: 568.4959999925923,
    responseEnd: 570.6329999957234,
    responseStart: 569.4220000004862,
    secureConnectionStart: 0,
    startTime: 566.357000003336
}
</code></pre>
                    </section>

                    <section>
                        <h2><code>initiatorType</code></h2>

                        <p><code>localName</code> of that element:</p>

                        <ul>
                            <li><code>img</code></li>
                            <li><code>link</code></li>
                            <li><code>script</code></li>
                            <li><code>css</code>: <code>url()</code>, <code>@import</code></li>
                            <li><code>xmlhttprequest</code></li>
                        </ul>
                    </section>

                    <section>
                        <h2>Use Cases</h2>

                        <ul>
                            <li>Send all resource timings to your backend analytics</li>

                            <li>Raise an analytics event if any resource takes over X seconds to download (and trend this data)</li>

                            <li>Watch specific resources (eg third-party ads or analytics) and complain if they are slow</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Buffer</h2>

                        <ul>
                            <li>There is a ResourceTiming buffer that stops filling after it's size limit is reached (default: 150 entries)</li>

                            <li>Listen for the <code>onresourcetimingbufferfull</code> event</li>

                            <li><code>setResourceTimingBufferSize(n)</code> and <code>clearResourceTimings()</code> can be used to modify it</li>

                            <li>Don't just: <code>setResourceTimingBufferSize(99999999)</code> as this can lead to browser memory growing
                                unbound</li>
                        </ul>

                    </section>

                    <section>
                        <h2>Compressing</h2>

                        <ul>
                            <li>Each resource is ~ 500 bytes <code>JSON.stringify()</code>'d</li>

                            <li><a href="http://httparchive.org">HTTP Archive</a> tells us there's 99 HTTP resources on average, per page,
                                with an average URL length of 85 bytes</li>

                            <li>That means you could expect around 45 KB of ResourceTiming data per page load</li>

                            <li>Compress it: <a href="http://nicj.net/compressing-resourcetiming/">nicj.net/compressing-resourcetiming</a></li>
                    </section>

                    <section>
                        <h2>Compressing</h2>

                        <p>Converts:</p>

<pre><code data-trim class="javascript">
{
    "responseEnd":323.1100000002698,
    "responseStart":300.5000000000000,
    "requestStart":252.68599999981234,
    "secureConnectionStart":0,
    "connectEnd":0,
    "connectStart":0,
    "domainLookupEnd":0,
    "domainLookupStart":0,
    "fetchStart":252.68599999981234,
    "redirectEnd":0,
    "redirectStart":0,
    "duration":71.42400000045745,
    "startTime":252.68599999981234,
    "entryType":"resource",
    "initiatorType":"script",
    "name":"http://foo.com/js/foo.js"
}
</code></pre>
                    </section>

                    <section>
                        <h2>Compressing</h2>

                        <p>To:</p>

<pre><code data-trim class="javascript">
{
    "http://": {
        "foo.com/": {
            "js/foo.js": "370,1z,1c",
            "css/foo.css": "48c,5k,14"
        },
        "moo.com/moo.gif": "312,34,56"
    }
}
</code></pre>

                        <p>Overall, compresses ResourceTiming data down to 15% of its original size</p>

                        <p><a href="https://github.com/nicjansma/resourcetiming-compression.js">github.com/nicjansma/resourcetiming-compression.js</a></p>

                    </section>

                    <section>
                        <h2>Timing-Allow-Origin</h2>

                        <ul>
                            <li>By default, cross-origin resources expose timestamps for only the <code>fetchStart</code>
                                and <code>responseEnd</code> attributes</li>

                            <li>This is to protect your privacy (attacker can’t load random URLs to see where you’ve been)</li>

                            <li>Override by setting <code>Timing-Allow-Origin</code> header</li>

                            <li><code>Timing-Allow-Origin = "Timing-Allow-Origin" ":" origin-list-or-null | "*"</code></li>

                            <li>If you have a CDN, <strong>use this</strong></li>

                            <li><strong>Note</strong>: Third-party libraries (ads, analytics, etc) must set this on their
                                servers.  5% do according to HTTP Archive.  Google, Facbook, Disqus, mPulse, etc.</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Blocking Time</h2>

                        <ul>
                            <li>Browsers will open a limited number of connections to each unique origin (protocol/server name/port)</li>

                            <li>If there are more resources than the # of connections, the later resources will be "blocking", waiting
                                for their turn to download</li>

                            <li><code>duration</code> includes Blocking time!</li>

                            <li>So in general, don't use <code>duration</code>, but this is all you get with cross-origin resources.</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Blocking Time</h2>

                        <p>Calculate:</p>
<pre><code data-trim class="javascript">
var waitTime = 0;
if (res.connectEnd && res.connectEnd === res.fetchStart)
{
    waitTime = res.requestStart - res.connectEnd;
}
else if (res.domainLookupStart)
{
    waitTime = res.domainLookupStart - res.fetchStart;
}
</code></pre>


                    </section>

                    <section>
                        <h2>DIY / Open Source</h2>

                        <!-- TODO: Show screenshots of each of these -->
                        <ul>
                            <li>Compress + send this data to your backend for logging</li>

                            <li>Show any page's resources via a bookmarklet: <a href="https://github.com/andydavies/waterfall">github.com/andydavies/waterfall</a></li>
                            <li>Heatmap bookmarklet / Chrome extension: <a href="https://github.com/zeman/perfmap">github.com/zeman/perfmap</a></li>
                            <li>Another bookmarklet: <br /><a href="https://github.com/nurun/performance-bookmarklet">github.com/nurun/performance-bookmarklet</a></li>
                            <li>Boomerang supports ResourceTiming: <a href="https://github.com/lognormal/boomerang">github.com/lognormal/boomerang</a></li>
                        </ul>
                    </section>

                    <section>
                        <h2>Commercial</h2>

                        <ul>
                            <li>SOASTA mPulse: <a href="http://soasta.com">soasta.com</a></li>
                            <li>New Relic Browser: <a href="http://newrelic.com">newrelic.com</a></li>
                            <li>App Dynamics Web EUEM: <a href="http://appdynamics.com/">appdynamics.com</a></li>
                            <!-- TODO
                                new-relic-browser-pro.png
                                appdynamics-webeuem.png
                            -->
                        </ul>
                    </section>

                    <section>
                        <h2>ResourceTiming</h2>

                        <p><a href="http://caniuse.com/#feat=resource-timing">caniuse.com/#feat=resource-timing</a></p>

                        <img src="images/resource-timing-caniuse.png" />
                    </section>

                    <section>
                        <h2>Tips</h2>

                        <ul>
                            <li>For many sites, most of your content will not be same-origin, so ensure all of your
                                CDNs and third-party libraries send <code>Timing-Allow-Origin</code></li>

                            <li>What isn't included in ResourceTiming:
                                <ul>
                                    <li>The root HTML page (get this from <code>window.performance.timing</code>)</li>
                                    <li>Transfer size or content size (privacy concerns)</li>
                                    <li>HTTP code (privacy concerns)</li>
                                </ul>
                            </li>
                        </ul>
                    </section>

                    <section>
                        <h2>Tips (pt 2)</h2>

                        <ul>

                            <li>If you're going to be managing the ResourceTiming buffer, make sure no other scripts
                                are managing it as well</li>

                            <li>The <code>duration</code> attribute includes Blocking time (when a resource is
                                behind other resources on the same socket)</li>

                            <li>Each <code>IFRAME</code> will have its own ResourceTiming data, and those resources
                                won't be included in the parent FRAME/document.  So you'll need to traverse the
                                document frames to get all resources.  See
                                <a href="https://github.com/nicjansma/resourcetiming-compression.js">github.com/nicjansma/resourcetiming-compression.js</a>
                                for an example</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Tips (pt 3)</h2>

                        <ul>
                            <li><code>secureConnectionStart</code> isn't available in IE</li>

                            <li>No Safari (iOS) or Opera support</li>

                            <li><code>about:blank</code>, <code>javascript:</code> URLs will be seen in RT data</li>
                        </ul>
                    </section>

                </section>

                <section>
                    <section>
                        <h2>UserTiming</h2>

                        <p><a href="http://www.w3.org/TR/user-timing/">www.w3.org/TR/user-timing</a></p>

                        <p style='margin-top: 50px'><strong>Goal: </strong> Standardized interface to note timestamps ("marks") and durations
                            ("measures")</p>

                        <p style='margin-top: 50px'><strong>Current status</strong>: Recommendation</p>

                    </section>

                    <section>
                        <h2>How it was done before</h2>

<pre><code data-trim class="javascript">
var start = new Date().getTime();
// do stuff
var now = new Date().getTime();
var latency = now - start;
</code></pre>
                    </section>

                    <section>
                        <h2>What's wrong with this?</h2>

                        <ul>
                            <li><i>Nothing really, but...</i></li>

                            <li><code>Date().getTime()</code> is not reliable</li>

                            <li>We can do better!</li>
                        </ul>
                    </section>

                    <section>
                        <h2>UserTiming</h2>

                        <p><code>window.performance</code></p>

<pre><code data-trim class="javascript">
partial interface Performance {
    void mark(DOMString markName);

    void clearMarks(optional  DOMString markName);

    void measure(DOMString measureName, optional DOMString startMark,
        optional DOMString endMark);

    void clearMeasures(optional DOMString measureName);
};
</code></pre>
                    </section>

                    <section>
                        <h2>How to Use - Mark</h2>

<pre><code data-trim class="javascript">
// mark
performance.mark("start");
performance.mark("end");

performance.mark("another");
performance.mark("another");
performance.mark("another");
</code></pre>
                    </section>

                    <section>
                        <h2>How to Use - Mark</h2>

<pre><code data-trim class="javascript">
// retrieve
performance.getEntriesByType("mark");

[
    {
        "duration":0,
        "startTime":150384.48100000096,
        "entryType":"mark",
        "name":"start"},
    {
        "duration":0,
        "startTime":150384.5250000013,
        "entryType":"mark",
        "name":"end"
    },
    ...
]
</code></pre>
                    </section>

                    <section>
                        <h2>How to Use - Measure</h2>

<pre><code data-trim class="javascript">
// measure
performance.mark("start");

performance.mark("start2");

// measure from "now" to navigatioNStart
performance.measure("time since navigationStart");

// measure from "now" to the "start" mark
performance.measure("time to do stuff", "start");

// measure from "start2" to the "start" mark
performance.measure("time from start to start2", "start", "start2");
</code></pre>
                    </section>

                    <section>
                        <h2>How to Use - Measure</h2>

<pre><code data-trim class="javascript">
// retrieval - specific
performance.getEntriesByName("time from start to start2", "measure");

[
    {
        "duration":4809.890999997151,
        "startTime":145287.66500000347,
        "entryType":"measure",
        "name":"time from start to start2"
    }
]
</code></pre>
                    </section>

                    <section>
                        <h2>Benefits</h2>

                        <ul>
                            <li>More efficient, as the native browser runtime can do math quicker and store things more performantly
                                than your JavaScript runtime can</li>

                            <li>Uses the <code>PerformanceTimeline</code>, so <code>marks</code> and <code>measures</code>
                                are in the PerformanceTimeline along with other events</li>

                            <li>Uses <code>DOMHighResTimestamp</code> instead of <code>Date</code> so sub-millisecond, monotonically non-decreasing,
                                etc</lli>
                        </ul>
                    </section>

                    <section>
                        <h2>Use Cases</h2>

                        <ul>
                            <li>Easy way to add profiling events to your application</li>

                            <li>Note important page- or scenario-specific events or durations in your Performance Timeline</li>

                            <li>Measure important durations for analytics</li>

                            <li>Browser tools are starting to add support for showing these</li>
                        </ul>
                    </section>

                    <section>
                        <h2>UserTiming</h2>

                        <p><a href="http://caniuse.com/#feat=user-timing">caniuse.com/#feat=user-timing</a></p>

                        <img src="images/user-timing-caniuse.png" />
                    </section>

                    <section>
                        <h2>UserTiming.js</h2>

                        <ul>
                            <li>Polyfill that adds UserTiming support to browsers that do not natively support it.</li>

                            <li>UserTiming is accessed via the PerformanceTimeline, and requires window.performance.now() support, so
                                UserTiming.js adds a limited version of these interfaces if the browser does not support them</li>

                            <li><a href="https://github.com/nicjansma/usertiming.js">github.com/nicjansma/usertiming.js</a></li>
                        </ul>
                    </section>

                    <section>
                        <h2>DIY / Open Source</h2>

                        <!-- TODO: Show screenshots of each of these -->
                        <ul>
                            <li>Compress + send this data to your backend for logging</li>
                            <li>Boomerang supports UserTiming: <a href="https://github.com/lognormal/boomerang">github.com/lognormal/boomerang</a></li>
                            <li>WebPageTest sends UserTiming to Google Analytics, Boomerang and SOASTA mPulse</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Commercial</h2>

                        <ul>
                            <li>SOASTA mPulse: <a href="http://soasta.com">soasta.com</a></li>
                            <li>WebPageTest: <a href="http://webpagetest.org">webpagetest.org</a></li>
                        </ul>

                    </section>

                    <section>
                        <h2>Tips</h2

                        <ul>
                            <li>Not the same as Google Analytic's "User Timings" API (<code>_trackTiming(...)</code>)</li>
                        </ul>
                    </section>
                </section>

                <section>
                    <h2>Links</h2>

                    <ul>
                        <li>Presentation: <a href="http://www.slideshare.net/nicjansma">slideshare.net/nicjansma</a></li>
                        <li>Code: <a href="https://github.com/nicjansma/talks/">github.com/nicjansma/talks</a></li>
                    </ul>

                    <p style='margin-top: 20px'><small>Thanks - Nic Jansma - <a href="http://nicj.net">nicj.net</a> - <a href="https://twitter.com/NicJ">@NicJ</a></small></p>
                </section>
            </div>
        </div>

        <script src="lib/js/head.min.js"></script>
        <script src="js/reveal.min.js"></script>

        <script>

            // Full list of configuration options available here:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: true,
                progress: true,
                history: true,
                center: true,

                theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
                transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

                // Optional libraries used to extend on reveal.js
                dependencies: [
                    { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                    { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
                    { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
                ]
            });

        </script>

    </body>
</html>
